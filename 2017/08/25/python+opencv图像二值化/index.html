<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>python+opencv图像二值化 | Hello World</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Goal
In this tutorial, you will learn Simple thresholding, Adaptive thresholding, Otsu’s thresholding etc.You will learn these functions : cv2.threshold, cv2.adaptiveThreshold etc.
Simple Thresholding">
<meta property="og:type" content="article">
<meta property="og:title" content="python+opencv图像二值化">
<meta property="og:url" content="http://gwang-cv.github.io/2017/08/25/python+opencv图像二值化/index.html">
<meta property="og:site_name" content="Hello World">
<meta property="og:description" content="Goal
In this tutorial, you will learn Simple thresholding, Adaptive thresholding, Otsu’s thresholding etc.You will learn these functions : cv2.threshold, cv2.adaptiveThreshold etc.
Simple Thresholding">
<meta property="og:image" content="http://docs.opencv.org/master/threshold.jpg">
<meta property="og:image" content="http://docs.opencv.org/master/ada_threshold.jpg">
<meta property="og:image" content="http://docs.opencv.org/master/otsu.jpg">
<meta property="og:updated_time" content="2017-08-25T08:27:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python+opencv图像二值化">
<meta name="twitter:description" content="Goal
In this tutorial, you will learn Simple thresholding, Adaptive thresholding, Otsu’s thresholding etc.You will learn these functions : cv2.threshold, cv2.adaptiveThreshold etc.
Simple Thresholding">
<meta name="twitter:image" content="http://docs.opencv.org/master/threshold.jpg">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://sites.google.com/site/2013gwang/logss.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Gang Wang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">a computer vision researchGO</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/gwang-cv" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/messiwang" title="weibo">weibo</a>
					        
								<a class="google" target="_blank" href="https://sites.google.com/site/2013gwang/" title="google">google</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Debug/" style="font-size: 13.33px;">Debug</a> <a href="/tags/DeepLearning/" style="font-size: 20px;">DeepLearning</a> <a href="/tags/ML/" style="font-size: 10px;">ML</a> <a href="/tags/Mac/" style="font-size: 16.67px;">Mac</a> <a href="/tags/Math/" style="font-size: 10px;">Math</a> <a href="/tags/Matlab/" style="font-size: 10px;">Matlab</a> <a href="/tags/Python/" style="font-size: 13.33px;">Python</a> <a href="/tags/Researcher/" style="font-size: 10px;">Researcher</a> <a href="/tags/python/" style="font-size: 10px;">python</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">Hello, I&#39;m Gang Wang. This is my blog, enjoy it.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Gang Wang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://sites.google.com/site/2013gwang/logss.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Gang Wang</h1>
			</hgroup>
			
			<p class="header-subtitle">a computer vision researchGO</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/gwang-cv" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/messiwang" title="weibo">weibo</a>
			        
						<a class="google" target="_blank" href="https://sites.google.com/site/2013gwang/" title="google">google</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-python+opencv图像二值化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/08/25/python+opencv图像二值化/" class="article-date">
  	<time datetime="2017-08-25T08:20:01.000Z" itemprop="datePublished">2017-08-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      python+opencv图像二值化
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Debug/">Debug</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Research/">Research</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Goal</strong></p>
<p>In this tutorial, you will learn Simple thresholding, Adaptive thresholding, Otsu’s thresholding etc.<br>You will learn these functions : cv2.threshold, cv2.adaptiveThreshold etc.</p>
<p><strong>Simple Thresholding</strong></p>
<p>Here, the matter is straight forward. If pixel value is greater than a threshold value, it is assigned one value (may be white), else it is assigned another value (may be black). The function used is cv2.threshold. First argument is the source image, which should be a grayscale image. Second argument is the threshold value which is used to classify the pixel values. Third argument is the maxVal which represents the value to be given if pixel value is more than (sometimes less than) the threshold value. OpenCV provides different styles of thresholding and it is decided by the fourth parameter of the function. Different types are:</p>
<pre><code>cv2<span class="class">.THRESH_BINARY</span>
cv2<span class="class">.THRESH_BINARY_INV</span>
cv2<span class="class">.THRESH_TRUNC</span>
cv2<span class="class">.THRESH_TOZERO</span>
cv2.THRESH_TOZERO_INV
</code></pre><p>Documentation clearly explain what each type is meant for. Please check out the documentation.</p>
<p>Two outputs are obtained. First one is a retval which will be explained later. Second output is our thresholded image.</p>
<p><strong>code:</strong></p>
<pre><code><span class="comment">#!/usr/bin/python</span>
<span class="comment"># -*- coding: UTF-8 -*-</span>
<span class="keyword">import</span> cv2
<span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> PIL <span class="keyword">import</span> Image 
<span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> matplotlib
<span class="keyword">import</span> os
<span class="keyword">import</span> sys
reload(sys) 
sys.setdefaultencoding(<span class="string">'utf-8'</span>) 

fln=<span class="string">'76.jpg'</span>
img = cv2.imread(fln,<span class="number">0</span>)
ret,thresh1 = cv2.threshold(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_BINARY)
ret,thresh2 = cv2.threshold(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_BINARY_INV)
ret,thresh3 = cv2.threshold(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_TRUNC)
ret,thresh4 = cv2.threshold(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_TOZERO)
ret,thresh5 = cv2.threshold(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_TOZERO_INV)
titles = [<span class="string">'Original_Image'</span>,<span class="string">'BINARY'</span>,<span class="string">'BINARY_INV'</span>,<span class="string">'TRUNC'</span>,<span class="string">'TOZERO'</span>,<span class="string">'TOZERO_INV'</span>]
images = [img, thresh1, thresh2, thresh3, thresh4, thresh5]
<span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">6</span>):
    cv2.imwrite(<span class="string">'0_'</span>+titles[i]+<span class="string">'.jpg'</span>,images[i])
    plt.subplot(<span class="number">2</span>,<span class="number">3</span>,i+<span class="number">1</span>),plt.imshow(images[i],<span class="string">'gray'</span>)

    plt.title(titles[i])
    plt.xticks([]), plt.yticks([])

plt.savefig(<span class="string">'res_'</span>+fln)
plt.show()
</code></pre><h2 id=""><img src="http://docs.opencv.org/master/threshold.jpg" alt="http://docs.opencv.org/master/threshold.jpg"></h2><p><strong>Adaptive Thresholding</strong></p>
<p>In the previous section, we used a global value as threshold value. But it may not be good in all the conditions where image has different lighting conditions in different areas. In that case, we go for adaptive thresholding. In this, the algorithm calculate the threshold for a small regions of the image. So we get different thresholds for different regions of the same image and it gives us better results for images with varying illumination.</p>
<p>It has three ‘special’ input params and only one output argument.</p>
<p>Adaptive Method - It decides how thresholding value is calculated.</p>
<pre><code>cv2.ADAPTIVE_THRESH_MEAN_C : threshold <span class="built_in">value</span> is <span class="operator">the</span> mean <span class="operator">of</span> neighbourhood area.
cv2.ADAPTIVE_THRESH_GAUSSIAN_C : threshold <span class="built_in">value</span> is <span class="operator">the</span> weighted <span class="built_in">sum</span> <span class="operator">of</span> neighbourhood values where weights are <span class="operator">a</span> gaussian window.
Block Size - It decides <span class="operator">the</span> size <span class="operator">of</span> neighbourhood area.
</code></pre><p>C - It is just a constant which is subtracted from the mean or weighted mean calculated.</p>
<p>Below piece of code compares global thresholding and adaptive thresholding for an image with varying illumination:</p>
<pre><code>import cv2
import numpy as np
from matplotlib import pyplot as plt
<span class="tag">img</span> = cv2.<span class="function"><span class="title">imread</span><span class="params">(<span class="string">'sudoku.png'</span>,<span class="number">0</span>)</span></span>
<span class="tag">img</span> = cv2.<span class="function"><span class="title">medianBlur</span><span class="params">(img,<span class="number">5</span>)</span></span>
ret,th1 = cv2.<span class="function"><span class="title">threshold</span><span class="params">(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_BINARY)</span></span>
th2 = cv2.adaptiveThreshold(<span class="tag">img</span>,<span class="number">255</span>,cv2<span class="class">.ADAPTIVE_THRESH_MEAN_C</span>,\
            cv2<span class="class">.THRESH_BINARY</span>,<span class="number">11</span>,<span class="number">2</span>)
th3 = cv2.adaptiveThreshold(<span class="tag">img</span>,<span class="number">255</span>,cv2<span class="class">.ADAPTIVE_THRESH_GAUSSIAN_C</span>,\
            cv2<span class="class">.THRESH_BINARY</span>,<span class="number">11</span>,<span class="number">2</span>)
titles = [<span class="string">'Original Image'</span>, <span class="string">'Global Thresholding (v = 127)'</span>,
            <span class="string">'Adaptive Mean Thresholding'</span>, <span class="string">'Adaptive Gaussian Thresholding'</span>]
images = [<span class="tag">img</span>, th1, th2, th3]
<span class="keyword">for</span> <span class="tag">i</span> <span class="keyword">in</span> <span class="function"><span class="title">xrange</span><span class="params">(<span class="number">4</span>)</span></span>:
    plt.<span class="function"><span class="title">subplot</span><span class="params">(<span class="number">2</span>,<span class="number">2</span>,i+<span class="number">1</span>)</span></span>,plt.<span class="function"><span class="title">imshow</span><span class="params">(images[i],<span class="string">'gray'</span>)</span></span>
    plt.<span class="function"><span class="title">title</span><span class="params">(titles[i])</span></span>
    plt.<span class="function"><span class="title">xticks</span><span class="params">([])</span></span>,plt.<span class="function"><span class="title">yticks</span><span class="params">([])</span></span>
plt.<span class="function"><span class="title">show</span><span class="params">()</span></span>    
</code></pre><p><img src="http://docs.opencv.org/master/ada_threshold.jpg" alt="result"></p>
<hr>
<p><strong>Otsu’s Binarization</strong></p>
<p>In the first section, I told you there is a second parameter retVal. Its use comes when we go for Otsu’s Binarization. So what is it?</p>
<p>In global thresholding, we used an arbitrary value for threshold value, right? So, how can we know a value we selected is good or not? Answer is, trial and error method. But consider a bimodal image (In simple words, bimodal image is an image whose histogram has two peaks). For that image, we can approximately take a value in the middle of those peaks as threshold value, right ? That is what Otsu binarization does. So in simple words, it automatically calculates a threshold value from image histogram for a bimodal image. (For images which are not bimodal, binarization won’t be accurate.)</p>
<p>For this, our cv2.threshold() function is used, but pass an extra flag, cv2.THRESH_OTSU. For threshold value, simply pass zero. Then the algorithm finds the optimal threshold value and returns you as the second output, retVal. If Otsu thresholding is not used, retVal is same as the threshold value you used.</p>
<p>Check out below example. Input image is a noisy image. In first case, I applied global thresholding for a value of 127. In second case, I applied Otsu’s thresholding directly. In third case, I filtered image with a 5x5 gaussian kernel to remove the noise, then applied Otsu thresholding. See how noise filtering improves the result.</p>
<pre><code><span class="built_in">import</span> cv2
<span class="built_in">import</span> numpy as np
from matplotlib <span class="built_in">import</span> pyplot as plt
img = cv2.imread<span class="params">('noisy2.png',<span class="number">0</span>)</span>
<span class="built_in">#</span> global thresholding
ret1,th1 = cv2.threshold<span class="params">(img,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_BINARY)</span>
<span class="built_in">#</span> Otsu's thresholding
ret2,th2 = cv2.threshold<span class="params">(img,<span class="number">0</span>,<span class="number">255</span>,cv2.THRESH_BINARY+cv2.THRESH_OTSU)</span>
<span class="built_in">#</span> Otsu's thresholding after Gaussian filtering
blur = cv2.GaussianBlur<span class="params">(img,<span class="params">(<span class="number">5</span>,<span class="number">5</span>)</span>,<span class="number">0</span>)</span>
ret3,th3 = cv2.threshold<span class="params">(blur,<span class="number">0</span>,<span class="number">255</span>,cv2.THRESH_BINARY+cv2.THRESH_OTSU)</span>
<span class="built_in">#</span> plot all the images and their histograms
images = [img, <span class="number">0</span>, th1,
          img, <span class="number">0</span>, th2,
          blur, <span class="number">0</span>, th3]
titles = ['Original Noisy Image','Histogram','Global Thresholding <span class="params">(v=<span class="number">127</span>)</span>',
          'Original Noisy Image','Histogram',<span class="string">"Otsu's Thresholding"</span>,
          'Gaussian filtered Image','Histogram',<span class="string">"Otsu's Thresholding"</span>]
<span class="keyword">for</span> i in xrange<span class="params">(<span class="number">3</span>)</span>:
    plt.subplot<span class="params">(<span class="number">3</span>,<span class="number">3</span>,i*<span class="number">3</span>+<span class="number">1</span>)</span>,plt.imshow<span class="params">(images[i*<span class="number">3</span>],'gray')</span>
    plt.title<span class="params">(titles[i*<span class="number">3</span>])</span>, plt.xticks<span class="params">([])</span>, plt.yticks<span class="params">([])</span>
    plt.subplot<span class="params">(<span class="number">3</span>,<span class="number">3</span>,i*<span class="number">3</span>+<span class="number">2</span>)</span>,plt.hist<span class="params">(images[i*<span class="number">3</span>].ravel<span class="params">()</span>,<span class="number">256</span>)</span>
    plt.title<span class="params">(titles[i*<span class="number">3</span>+<span class="number">1</span>])</span>, plt.xticks<span class="params">([])</span>, plt.yticks<span class="params">([])</span>
    plt.subplot<span class="params">(<span class="number">3</span>,<span class="number">3</span>,i*<span class="number">3</span>+<span class="number">3</span>)</span>,plt.imshow<span class="params">(images[i*<span class="number">3</span>+<span class="number">2</span>],'gray')</span>
    plt.title<span class="params">(titles[i*<span class="number">3</span>+<span class="number">2</span>])</span>, plt.xticks<span class="params">([])</span>, plt.yticks<span class="params">([])</span>
plt.show<span class="params">()</span>
</code></pre><h2 id="-1"><img src="http://docs.opencv.org/master/otsu.jpg" alt="http://docs.opencv.org/master/otsu.jpg"></h2><p>Link:</p>
<p><a href="http://docs.opencv.org/master/d7/d4d/tutorial_py_thresholding.html" target="_blank" rel="external">http://docs.opencv.org/master/d7/d4d/tutorial_py_thresholding.html</a></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/08/31/Caffe训练分类模型/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Caffe训练分类模型
        
      </div>
    </a>
  
  
    <a href="/2017/08/25/Tesseract4.0+jTessBoxEditor训练(ubuntu下)/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Tesseract4.0+jTessBoxEditor训练(ubuntu下)</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>








</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Gang Wang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>